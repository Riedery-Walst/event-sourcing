# Система заказов в кофейне

Использовалось:
- Java 17
- JDK 20
- Maven 4.0.0

### Зависимости

- [Spring Web](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot)
- [Lombok](https://mvnrepository.com/artifact/org.projectlombok/lombok)
- [PostgreSQL Driver](https://mvnrepository.com/artifact/org.postgresql/postgresql)
- [Spring Data JPA](https://mvnrepository.com/artifact/org.springframework.data/spring-data-jpa)
- [Gson](https://mvnrepository.com/artifact/com.google.code.gson/gson)

### Запуск

`git clone https://github.com/Riedery-Walst/ufanet`</br>
</br>
После клонирования репозитория вам нужно будет настроить базу данных в <b>application.properties</b>:
```
spring.datasource.url=jdbc:postgresql://localhost:5432/your_db
spring.datasource.username=your_username
spring.datasource.password=your_password
```
Соберите проект командной: 
`mvn clean install`</br>
Затем запустите: 
`java -jar target/ufanet.jar`</br>

## Тестовое задание

Предположим, что у нас есть кофейня и она принимает заказы, используя CRM систему. Попадая в систему заказ может пройти следующие стадии:

- Заказ зарегистрирован
- Заказ принят в работу
- Заказ отменен
- Заказ готов к выдаче
- Заказ выдан

Переход заказа в каждую из стадий сопровождается генерацией соответствующего события. Система устроена таким образом, что заказ хранится в базе в виде цепочки событий (см. event sourcing). Причины по котором был выбран такой подход - гибкость в плане дальнейшего разбиения заказа на этапы, что, например, необходимо для анализа трудозатрат и выявления проблем в скорости обслуживания клиентов.

### События

Приводим список событий и набор данных, которые они должны в себе содержать.

### Заказ зарегистрирован

- Идентификатор заказа
- Идентификатор клиента
- Идентификтор сотрудника
- Ожидаемое время выдачи
- Идентфикатор товара
- Стоимость товара
- Дата и время

### Заказ отменен

- Идентификатор заказа
- Идентификтор сотрудника
- Причина отмены заказа
- Дата и время

### Заказ взят в работу

- Идентификатор заказа
- Идентификтор сотрудника
- Дата и время

### Заказ готов к выдаче

- Идентификатор заказа
- Идентификтор сотрудника
- Дата и время

### Заказ выдан

- Идентификатор заказа
- Идентификтор сотрудника
- Дата и время

## Задача

### Обработка событий

Необходимо реализовать обработку событий. В первую очередь нужно выполнить проверку условий:

- Любому из событий должно предшествовать событие регистрации заказа
- Если заказ уже выдан или отменен, то публикация новых событий недоступна

Требование к БД - она должна быть реляционной.

### Получение информации по заказу

Необходимо реализовать получение полной информации по заказу на основе агрегации имеющихся по нему событий. В частности в модели должен быть отражен текущий статус (этап) заказа и присутствовать список событий с информацией о типе событий и времени его создания.

### Интерфейс для имплементации

```java
interface OrderService {

   void publishEvent(OrderEvent event);

   Order findOrder(int id);

}
```
